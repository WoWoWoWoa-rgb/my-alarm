<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>ã‚¢ãƒ©ãƒ¼ãƒ </title>
</head>
<body>
  <h1>â° ã‚¢ãƒ©ãƒ¼ãƒ ã‚’ã‚»ãƒƒãƒˆ</h1>

  <label>ä½•æ™‚é–“å¾Œ: <input type="number" id="hour" min="0" value="0"></label><br>
  <label>ä½•åˆ†å¾Œ: <input type="number" id="minute" min="0" value="0"></label><br>
  <label>ä½•ç§’å¾Œ: <input type="number" id="second" min="0" value="0"></label><br><br>

  <button onclick="setAlarm()">âœ… ã‚¢ãƒ©ãƒ¼ãƒ ã‚’é–‹å§‹</button>
  <button id="stopButton" onclick="stopAlarm()" style="display:none;">ğŸ›‘ ã‚¢ãƒ©ãƒ¼ãƒ ã‚’æ­¢ã‚ã‚‹</button>

  <p id="status">å¾…æ©Ÿä¸­...</p>

  <audio id="alarmSound" src="./02 - Old Man River.mp3" preload="auto" loop></audio>

  <script>
    let alarmTimeout = null;
    let isAudioAllowed = false;

    function setAlarm() {
      const hours = parseInt(document.getElementById("hour").value) || 0;
      const minutes = parseInt(document.getElementById("minute").value) || 0;
      const seconds = parseInt(document.getElementById("second").value) || 0;

      const totalMs = (hours * 3600 + minutes * 60 + seconds) * 1000;

      if (totalMs <= 0) {
        alert("â³ 1ç§’ä»¥ä¸Šã®æ™‚é–“ã‚’è¨­å®šã—ã¦ãã ã•ã„ã€‚");
        return;
      }

      const audio = document.getElementById("alarmSound");

      // åˆå›ã®å†ç”Ÿè¨±å¯ã‚’ã“ã“ã§è©¦ã¿ã‚‹ï¼ˆè‡ªå‹•è¨±å¯ã‚’å¾—ã‚‹ï¼‰
      audio.play().then(() => {
        audio.pause();
        audio.currentTime = 0;
        isAudioAllowed = true;
      }).catch((e) => {
        console.warn("è‡ªå‹•å†ç”Ÿã¯ã¾ã è¨±å¯ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚ãƒ¦ãƒ¼ã‚¶ãƒ¼æ“ä½œã‚’å¾…ã¡ã¾ã™ã€‚");
      });

      document.getElementById("status").innerText =
        `â³ ã‚¢ãƒ©ãƒ¼ãƒ ã‚’ ${hours}æ™‚é–“${minutes}åˆ†${seconds}ç§’å¾Œã«ã‚»ãƒƒãƒˆã—ã¾ã—ãŸã€‚`;

      // ã‚¢ãƒ©ãƒ¼ãƒ ã‚’äºˆç´„
      alarmTimeout = setTimeout(() => {
        document.getElementById("status").innerText = "â° ã‚¢ãƒ©ãƒ¼ãƒ ç™ºå‹•ï¼";
        audio.play().catch(e => {
          document.getElementById("status").innerText = "âš ï¸ éŸ³å£°ãŒå†ç”Ÿã§ãã¾ã›ã‚“ã§ã—ãŸ";
          console.error(e);
        });
        document.getElementById("stopButton").style.display = "inline-block";
      }, totalMs);
    }

    function stopAlarm() {
      const audio = document.getElementById("alarmSound");
      audio.pause();
      audio.currentTime = 0;
      document.getElementById("status").innerText = "âœ… ã‚¢ãƒ©ãƒ¼ãƒ åœæ­¢ä¸­";
      document.getElementById("stopButton").style.display = "none";
      clearTimeout(alarmTimeout);
    }
  </script>
</body>
</html>
