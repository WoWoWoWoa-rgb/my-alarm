<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>ã‚¢ãƒ©ãƒ¼ãƒ </title>
</head>
<body>
  <h1>â° ã‚¢ãƒ©ãƒ¼ãƒ ã‚’ã‚»ãƒƒãƒˆ</h1>

  <label>æ™‚ï¼ˆ0ã€œ23ï¼‰: <input type="number" id="hour" min="0" max="23"></label><br>
  <label>åˆ†ï¼ˆ0ã€œ59ï¼‰: <input type="number" id="minute" min="0" max="59"></label><br>
  <label>ç§’ï¼ˆ0ã€œ59ï¼‰: <input type="number" id="second" min="0" max="59"></label><br><br>

  <button onclick="testAudio()">ğŸ”Š éŸ³ã®ãƒ†ã‚¹ãƒˆï¼ˆå¿…ãšå…ˆã«æŠ¼ã—ã¦ãã ã•ã„ï¼‰</button><br><br>
  <button onclick="setAlarm()">âœ… ã‚¢ãƒ©ãƒ¼ãƒ ã‚’é–‹å§‹</button>

  <p id="status">å¾…æ©Ÿä¸­...</p>

  <!-- éŸ³å£°ãƒ•ã‚¡ã‚¤ãƒ«ï¼šMP3ã‚„WAVå¯ã€‚è‡ªç”±ã«å·®ã—æ›¿ãˆå¯èƒ½ -->
  <audio id="alarmSound" src="./02 - Old Man River.mp3" preload="auto"></audio>

  <script>
    let alarmTime = null;

    // éŸ³ã®å†ç”Ÿãƒ†ã‚¹ãƒˆç”¨ï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼æ“ä½œã§å†ç”Ÿè¨±å¯ã‚’å¾—ã‚‹ï¼‰
    function testAudio() {
      const audio = document.getElementById("alarmSound");
      audio.play().then(() => {
        audio.pause();
        audio.currentTime = 0;
        alert("ğŸ”Š éŸ³å£°ã®å†ç”ŸãŒè¨±å¯ã•ã‚Œã¾ã—ãŸã€‚æ¬¡ã«ã‚¢ãƒ©ãƒ¼ãƒ ã‚’ã‚»ãƒƒãƒˆã—ã¦ãã ã•ã„ã€‚");
      }).catch((e) => {
        alert("âš ï¸ éŸ³å£°å†ç”ŸãŒãƒ–ãƒ­ãƒƒã‚¯ã•ã‚Œã¾ã—ãŸã€‚ã‚‚ã†ä¸€åº¦ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ãã ã•ã„ã€‚");
        console.warn("éŸ³å£°å†ç”Ÿãƒ–ãƒ­ãƒƒã‚¯ï¼š", e);
      });
    }

    function setAlarm() {
      const hour = parseInt(document.getElementById("hour").value);
      const minute = parseInt(document.getElementById("minute").value);
      const second = parseInt(document.getElementById("second").value);
      const now = new Date();
      alarmTime = new Date();
      alarmTime.setHours(hour);
      alarmTime.setMinutes(minute);
      alarmTime.setSeconds(second);

      if (alarmTime <= now) {
        alarmTime.setDate(alarmTime.getDate() + 1);  // æ¬¡ã®æ—¥ã«è¨­å®š
      }

      document.getElementById("status").innerText =
        `ğŸ•’ ã‚¢ãƒ©ãƒ¼ãƒ ã‚’ ${alarmTime.toLocaleTimeString()} ã«ã‚»ãƒƒãƒˆã—ã¾ã—ãŸ`;

      checkAlarm();
    }

    function checkAlarm() {
      const interval = setInterval(() => {
        const now = new Date();
        if (alarmTime && now >= alarmTime) {
          clearInterval(interval);
          document.getElementById("status").innerText = "â° ã‚¢ãƒ©ãƒ¼ãƒ ç™ºå‹•ï¼";
          const audio = document.getElementById("alarmSound");
          audio.play().catch(e => {
            document.getElementById("status").innerText = "âš ï¸ éŸ³å£°ãŒå†ç”Ÿã§ãã¾ã›ã‚“ã§ã—ãŸ";
            console.error(e);
          });
        }
      }, 1000);
    }
  </script>
</body>
</html>
